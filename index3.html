import cv2
import pytesseract
import pandas as pd
import os

class TableExtractor:
    def __init__(self, folder_path):
        self.folder_path = folder_path
        self.extracted_text = []

    def preprocess_image(self, image):
        gray_image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
        _, binary_image = cv2.threshold(gray_image, 127, 255, cv2.THRESH_BINARY)
        return binary_image

    def perform_ocr(self, binary_image):
        return pytesseract.image_to_string(binary_image)

    def extract_from_images(self):
        for file in sorted(os.listdir(self.folder_path)):
            if file.startswith("page") and file.endswith(".jpg"):
                image_path = os.path.join(self.folder_path, file)
                image = cv2.imread(image_path)
                binary_image = self.preprocess_image(image)
                extracted_text = self.perform_ocr(binary_image)
                self.extracted_text.append(extracted_text)
                print("Text extracted from:", file)
                # Add 5 empty rows
                for _ in range(5):
                    self.extracted_text.append('')

    def save_to_csv(self, csv_path):
        rows = [row.split('\n') for text in self.extracted_text for row in text.split('\n\n')]
        df = pd.DataFrame(rows)
        df.to_csv(csv_path, index=False)
        print("Data extracted and saved to:", csv_path)

    def run_extraction(self, csv_path):
        self.extract_from_images()
        self.save_to_csv(csv_path)

if __name__ == "__main__":
    # Replace 'folder_path' and 'output_table.csv' with your folder path containing images and desired CSV file path
    extractor = TableExtractor(folder_path='folder_containing_images')
    extractor.run_extraction(csv_path='output_table.csv')
