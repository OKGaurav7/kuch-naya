import cv2
import pytesseract
import pandas as pd
import numpy as np

class TableExtractor:
    def __init__(self, image_path):
        self.image_path = image_path
        self.image = cv2.imread(self.image_path)
        self.extracted_text = None

    def preprocess_image(self):
        gray_image = cv2.cvtColor(self.image, cv2.COLOR_BGR2GRAY)
        _, binary_image = cv2.threshold(gray_image, 127, 255, cv2.THRESH_BINARY)
        return binary_image

    def perform_ocr(self, binary_image):
        self.extracted_text = pytesseract.image_to_string(binary_image)

    def save_to_csv(self, csv_path):
        rows = [row.split('\n') for row in self.extracted_text.split('\n\n')]
        df = pd.DataFrame(rows)
        df.to_csv(csv_path, index=False)
        print("Data extracted and saved to:", csv_path)

    def run_extraction(self, csv_path):
        binary_image = self.preprocess_image()
        self.perform_ocr(binary_image)
        self.save_to_csv(csv_path)

if __name__ == "__main__":
    # Replace 'image_path' and 'output_table.csv' with your image path and desired CSV file path
    extractor = TableExtractor(image_path=r'\\asiapac.nom\home\userdata\MUM\HomeDrive24\chauhang\Desktop\Image to excel\page1.jpg')
    extractor.run_extraction(csv_path='output_table.csv')
