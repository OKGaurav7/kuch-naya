import pandas as pd
import openpyxl
from openpyxl import load_workbook
from openpyxl.styles import PatternFill, Font, Border, Side, Alignment
from openpyxl.utils import get_column_letter
from datetime import datetime
import random

def apply_styling(ws, header_fill_color="C00000", header_font_color="FFFFFF", condition_fill_color="FFC7CE", border_color="000000"):
    # Set header cells background color
    header_fill = PatternFill(start_color=header_fill_color, end_color=header_fill_color, fill_type="solid")
    header_font = Font(color=header_font_color, bold=True)

    # Set conditional formatting color
    condition_fill = PatternFill(start_color=condition_fill_color, end_color=condition_fill_color, fill_type="solid")

    # Add cell borders
    border = Border(left=Side(border_style='thin', color=border_color),
                    right=Side(border_style='thin', color=border_color),
                    top=Side(border_style='thin', color=border_color),
                    bottom=Side(border_style='thin', color=border_color))

    # Apply styles to header cells
    for cell in ws[1]:
        cell.fill = header_fill
        cell.font = header_font
        cell.alignment=Alignment(horizontal="center")
        if cell.value=='currentObligorRdmId':
            ws.column_dimensions[get_column_letter(cell.column)].width = 20

        elif cell.value=='currentObligorFullName':
            ws.column_dimensions[get_column_letter(cell.column)].width = 43        
        
    # economic_impact_col = None
    # for cell in ws[1]:
    #     if cell.value == 'Economic Impact':
    #         economic_impact_col = cell.column
    #         break

    # if economic_impact_col:
    #     for row in ws.iter_rows(min_row=2):
    #         for cell in row:
    #             if cell.column == economic_impact_col:
    #                 if cell.value is not None and cell.value < 0:
    #                     cell.fill = condition_fill
    # Apply conditional formatting to "Days Elapsed" column
    days_elapsed_col = None
    for cell in ws[1]:
        if cell.value == 'Days Elapsed':
            days_elapsed_col = cell.column
            break
    if days_elapsed_col:
        for row in ws.iter_rows(min_row=2):
            for cell in row:
                if cell.column == days_elapsed_col:
                    if cell.value is not None and cell.value > 7:
                        cell.fill = condition_fill
    # Apply borders to all cells
    for row in ws.iter_rows():
        for cell in row:
            if cell.value is not None:
                cell.border = border
    # Format "Trade Date" and "Value Date" columns as short date
    for col in ws.iter_cols(min_col=1, max_col=ws.max_column):
        if ws.cell(row=1, column=col[0].column).value in ["Trade Date", "Value Date"]:
            for cell in col:
                cell.number_format = 'yyyy-mm-dd'
